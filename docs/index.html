<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>AlertManager Telegram Bot</title>
	<meta name="description" content="Documentation for AlertManager Telegram Bot">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<link rel="stylesheet" href="assets/css/dark.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">AlertManager Telegram Bot</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1>AlertManager Telegram Bot</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#alertmanager-telegram-bot" id="alertmanager-telegram-bot" style="color: inherit; text-decoration: none;">
					<h1>Alertmanager telegram bot</h1>
				</a>
				<blockquote>
					<p>Yet another Prometheus alertmanager&#39;s telegram bot</p>
				</blockquote>
				<p><img src="https://img.shields.io/github/license/wwmoraes/alertmanager-telegram-bot" alt="GitHub license">
					<img src="https://img.shields.io/github/languages/top/wwmoraes/alertmanager-telegram-bot" alt="GitHub top language">
					<img src="https://img.shields.io/github/repo-size/wwmoraes/alertmanager-telegram-bot" alt="GitHub repo size">
				<img src="https://img.shields.io/docker/image-size/wwmoraes/alertmanager-telegram-bot" alt="Docker Image Size (latest by date)"></p>
				<p><img src="https://img.shields.io/github/last-commit/wwmoraes/alertmanager-telegram-bot" alt="GitHub last commit">
				<img src="https://img.shields.io/github/workflow/status/wwmoraes/alertmanager-telegram-bot/DockerHub" alt="GitHub Workflow Status"></p>
				<p><img src="https://img.shields.io/codeclimate/maintainability-percentage/wwmoraes/alertmanager-telegram-bot" alt="Code Climate maintainability">
					<img src="https://img.shields.io/codeclimate/issues/wwmoraes/alertmanager-telegram-bot" alt="Code Climate issues">
				<img src="https://img.shields.io/codeclimate/tech-debt/wwmoraes/alertmanager-telegram-bot" alt="Code Climate technical debt"></p>
				<p>This is a work in progress, so take all functionalities with a grain of salt.</p>
				<p>You can also <a href="http://wwmoraes.github.io/alertmanager-telegram-bot">jump directly to the docs</a>.</p>
				<a href="#table-of-contents" id="table-of-contents" style="color: inherit; text-decoration: none;">
					<h2>Table of Contents</h2>
				</a>
				<ul>
					<li><a href="#about">About</a></li>
					<li><a href="#getting_started">Getting Started</a></li>
					<li><a href="#usage">Usage</a></li>
					<li><a href="../CONTRIBUTING.md">Contributing</a></li>
				</ul>
				<a href="#about-" id="about-" style="color: inherit; text-decoration: none;">
					<h2>About <a name = "about"></a></h2>
				</a>
				<p>A bot that uses some fancy features from telegram as inline keyboards and replies
				to messages instead of the boring slash commands.</p>
				<a href="#getting-started-" id="getting-started-" style="color: inherit; text-decoration: none;">
					<h2>Getting Started <a name = "getting_started"></a></h2>
				</a>
				<p>You can setup the bot using those environment variables:</p>
				<table>
					<thead>
						<tr>
							<th>variable</th>
							<th>default</th>
							<th>description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>TELEGRAM_ADMINS</td>
							<td><code>undefined</code></td>
							<td>comma-separated telegram user IDs, which the bot will talk to</td>
						</tr>
						<tr>
							<td>TELEGRAM_TOKEN</td>
							<td><code>undefined</code></td>
							<td>your bot token</td>
						</tr>
						<tr>
							<td>TEMPLATE_FILE</td>
							<td><code>default.tmpl</code></td>
							<td>template file path to use for messages</td>
						</tr>
						<tr>
							<td>EXTERNAL_URL</td>
							<td><code>http://127.0.0.1:9093</code></td>
							<td>endpoint to register the webhook on Telegram (useful for reversed-proxy deployments)</td>
						</tr>
						<tr>
							<td>INTERNAL_URL</td>
							<td><code>undefined</code></td>
							<td>alertmanager URL to send API requests (default: uses <code>externalURL</code> provided on the alert)</td>
						</tr>
						<tr>
							<td>ALERTMANAGER_DB_PATH</td>
							<td><code>data/alertmanager</code></td>
							<td>database path for alertmanager graph storage (LevelGraph)</td>
						</tr>
						<tr>
							<td>ALERTS_DB_PATH</td>
							<td><code>data/alerts</code></td>
							<td>database path for alert storage (LevelDB)</td>
						</tr>
				</tbody></table>
				<a href="#prerequisites" id="prerequisites" style="color: inherit; text-decoration: none;">
					<h3>Prerequisites</h3>
				</a>
				<p>If running locally, nodejs and yarn, and install all dependencies:</p>
				<pre><code class="language-shell">yarn install</code></pre>
				<p>Otherwise you can use docker:</p>
				<pre><code class="language-shell">docker build -t wwmoraes/alertmanager-telegram-bot .</code></pre>
				<a href="#message-template" id="message-template" style="color: inherit; text-decoration: none;">
					<h3>message template</h3>
				</a>
				<p>For formatting messages the bot uses <a href="https://github.com/olado/doT">doT</a> + a
					linebreak replacement. You can provide a custom template file by mounting your file
					as a volume + setting the path on <code>TEMPLATE_FILE</code>. All <code>br</code> HTML tags will be
				replaced by line breaks.</p>
				<a href="#using-it-as-a-module-on-another-bot" id="using-it-as-a-module-on-another-bot" style="color: inherit; text-decoration: none;">
					<h3>using it as a module on another bot</h3>
				</a>
				<p>The alertmanager logic is also available as a Telegraf module to be used on other
				bots. You can do so with</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">import</span> {
  AlertManagerContext,
  AlertManagerMiddleware,
  setupAlertManagerContext,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./AlertManager&quot;</span>;

<span class="hljs-keyword">interface</span> YourBotContext <span class="hljs-keyword">extends</span> AlertManagerContext {}

<span class="hljs-keyword">const</span> bot = <span class="hljs-keyword">new</span> Telegraf&lt;YourBotContext&gt;(<span class="hljs-string">&quot;your-bot-token&quot;</span>);

setupAlertManagerContext(bot);

bot.use(AlertManagerMiddleware);</code></pre>
				<a href="#usage-" id="usage-" style="color: inherit; text-decoration: none;">
					<h2>Usage <a name = "usage"></a></h2>
				</a>
				<pre><code class="language-shell">yarn start</code></pre>
				<p>OR</p>
				<pre><code class="language-shell">docker run --rm -it --env-file=.env -p 8443:8443 wwmoraes/alertmanager-telegram-bot</code></pre>
				<p>The bot itself is very straightforward, and does most of the actions using inline
				keyboards. You can enroll yourself to receive the AM alerts using <code>/start</code> ðŸ˜„</p>
				<a href="#slash-commands" id="slash-commands" style="color: inherit; text-decoration: none;">
					<h3>Slash commands</h3>
				</a>
				<p>The alertmanager middleware uses no slash commands, and instead automatically
				registers the given user IDs to receive notifications.</p>
				<p>If using the full bot from this repository, then you can use:</p>
				<ul>
					<li><code>/start</code> - registers yourself to receive the alerts</li>
					<li><code>/help</code> - well, halp ðŸ˜‚</li>
				</ul>
				<p>It also responds to <code>hi</code> and stickers as a &quot;health check&quot;.</p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/alertmanager.html">Alert<wbr>Manager</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/bot.html">Bot</a>
					</li>
					<li class=" tsd-kind-namespace">
						<a href="modules/nodejs.html">NodeJS</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/useronly.html">User<wbr>Only</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-function tsd-has-type-parameter"><span class="tsd-kind-icon">Function with type parameter</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="assets/js/search.js"><' + '/script>');</script>
</body>
</html>